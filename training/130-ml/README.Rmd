---
title: "Machine Learning"
author: "Daniel Chen"
date: ""
output: # html_document
  md_document:
    variant: markdown_github
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

> The fact that data science exists as a field is a colossal failure of statistics. To me, that is what statistics is all about. It is gaining insight from data using modelling and visualization. Data munging and manipulation is hard and statistics has just said that’s not our domain.”

- Hadley Wickham, PhD

https://priceonomics.com/hadley-wickham-the-man-who-revolutionized-r/

```{r}
diamonds <- ggplot2::diamonds
economics <- ggplot2::economics
```

# Introduction

Understanding your dataset is more important than fitting a model and calling it a day.

https://rpubs.com/neilfws/91339

```{r}
data(anscombe)
summary(anscombe)
```

```{r}
sapply(1:4, function(x) cor(anscombe[, x], anscombe[, x+4]))
```

```{r}
sapply(5:8, function(x) var(anscombe[, x]))
```

```{r}
lm(y1 ~ x1, data = anscombe)
```

```{r}
library(ggplot2)
library(gridExtra)

p1 <- ggplot(anscombe) +
  geom_point(aes(x1, y1), color = "darkorange", size = 3) +
  theme_bw() +
  scale_x_continuous(breaks = seq(0, 20, 2)) +
  scale_y_continuous(breaks = seq(0, 12, 2)) +
  geom_abline(intercept = 3, slope = 0.5, color = "cornflowerblue") +
  expand_limits(x = 0, y = 0) +
  labs(title = "dataset 1")

p2 <- ggplot(anscombe) +
  geom_point(aes(x2, y2), color = "darkorange", size = 3) +
  theme_bw() +
  scale_x_continuous(breaks = seq(0, 20, 2)) +
  scale_y_continuous(breaks = seq(0, 12, 2)) +
  geom_abline(intercept = 3, slope = 0.5, color = "cornflowerblue") +
  expand_limits(x = 0, y = 0) +
  labs(title = "dataset 2")

p3 <- ggplot(anscombe) +
  geom_point(aes(x3, y3), color = "darkorange", size = 3) +
  theme_bw() +
  scale_x_continuous(breaks = seq(0, 20, 2)) +
  scale_y_continuous(breaks = seq(0, 12, 2)) +
  geom_abline(intercept = 3, slope = 0.5, color = "cornflowerblue") +
  expand_limits(x = 0, y = 0) +
  labs(title = "dataset 3")

p4 <- ggplot(anscombe) +
  geom_point(aes(x4, y4), color = "darkorange", size = 3) +
  theme_bw() +
  scale_x_continuous(breaks = seq(0, 20, 2)) +
  scale_y_continuous(breaks = seq(0, 12, 2)) +
  geom_abline(intercept = 3, slope = 0.5, color = "cornflowerblue") +
  expand_limits(x = 0, y = 0) +
  labs(title = "dataset 4")

sdalr::multiplot(p1, p2, p3, p4, cols = 2)
```

## anscombosaurus

```{r}
data("anscombosaurus", package = 'sdalr')

summary(anscombosaurus)
```

# Summary Statistics

```{r}
summary(diamonds$price)
```

```{r}
summary(diamonds)
```

```{r}
mean(diamonds$price)
sd(diamonds$price)
quantile(diamonds$price, probs = 0.25)
```

## Correlation

$$
r_{xy} = \dfrac{\sum_{i = 1}^n (x_i - \bar{x}) (y_i - \bar{y})}{(n - 1) s_x s_y}
$$

```{r}
cor(economics$pce, economics$psavert)
```

```{r}
GGally::ggpairs(data = dplyr::select(economics, -date, -pop))
```

```{r}
GGally::wrap(
  GGally::ggpairs(data = dplyr::select(economics, -date, -pop)),
  labelSize = 8
)
```

## Covariance

$$
cov(X, Y) = \dfrac{1}{N - 1} \sum_{i = 1}^N (x_i - \bar{x})(y_i - \bar{y})
$$

```{r}
cov(economics$pce, economics$psavert)
```

```{r}
identical(
  cov(economics$pce, economics$psavert),
  cor(economics$pce, economics$psavert) *
    sd(economics$pce) *
    sd(economics$psavert)
)
```

# Linear Models

```{r}
data(diamonds, package = 'ggplot2')
```

```{r}
head(diamonds)
```


```{r}
glm(formula = price ~ carat, data = diamonds)
```

```{r}
glm(formula = price ~ carat + depth + table + x + y + z, data = diamonds)
```

```{r}
m <- glm(formula = price ~ carat + depth + table + x + y + z, data = diamonds)
summary(m)
```

```{r}
library(broom)

broom::tidy(m)

head(broom::augment(m))

broom::glance(m)
```

```{r}
plot(m)
```

# Generalized Linear Models

## Logistic

```
[, 1]	 mpg	 Miles/(US) gallon
[, 2]	 cyl	 Number of cylinders
[, 3]	 disp	 Displacement (cu.in.)
[, 4]	 hp	 Gross horsepower
[, 5]	 drat	 Rear axle ratio
[, 6]	 wt	 Weight (1000 lbs)
[, 7]	 qsec	 1/4 mile time
[, 8]	 vs	 V/S
[, 9]	 am	 Transmission (0 = automatic, 1 = manual)
[,10]	 gear	 Number of forward gears
[,11]	 carb	 Number of carburetors
```

```{r}
mpg_bin <- function(mpg) {
  if (mpg > 22) {
    return('good')
  } else {
    return('poor')
  }
}

mpg_bin_int <- function(mpg) {
  if (mpg > 22) {
    return(1)
  } else {
    return(0)
  }
}

mtcars$mpg_bin <- sapply(X = mtcars$mpg, FUN = mpg_bin)
mtcars$mpg_bin_int <- sapply(X = mtcars$mpg, FUN = mpg_bin_int)
head(mtcars)
```

```{r}
m <- glm(formula = as.factor(mpg_bin) ~ cyl + hp + wt + as.factor(am),
         data = mtcars,
         family = binomial(link = 'logit'))
summary(m)
broom::tidy(m)
```

```{r}
m <- glm(formula = as.factor(mpg_bin_int) ~ cyl + hp + wt + as.factor(am),
         data = mtcars,
         family = binomial(link = 'logit'))
summary(m)
broom::tidy(m)
```

```{r}
results  <- broom::tidy(m)
results$or <- exp(results$estimate)
results
```

## Survival Analysis

```{r}
library(survival)
head(bladder)
```

```{r}
s <- Surv(bladder$stop, bladder$event)
```

```{r}
cox <- coxph(Surv(stop, event) ~ rx + number + size + enum, data = bladder)
summary(cox)
```

```{r}
plot(survfit(cox), xlab = 'days', ylab = 'Survival Rate', conf.int = TRUE)
```

```{r}
cox <- coxph(Surv(stop, event) ~ strata(rx) + number + size + enum, data = bladder)
summary(cox)
plot(survfit(cox), xlab = 'days', ylab = 'Survival Rate', conf.int = TRUE, col = 1:2)
legend("bottomleft", legend = c(1, 2), lty = 1, col = 1:2, text.col = 1:2, title = 'rx')
```

